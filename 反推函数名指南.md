# é€šè¿‡ 9.9.12-25493 wrapper.node åæ¨ç­¾åå‡½æ•°å

## ç›®æ ‡

ä»å·²çŸ¥å¯ç”¨çš„ QQ ç‰ˆæœ¬ 9.9.12-25493ï¼ˆåç§»å€¼ 0xA996E0ï¼‰ä¸­æ‰¾åˆ°ç­¾åå‡½æ•°çš„çœŸå®åç§°ã€‚

## å‡†å¤‡å·¥ä½œ

### 1. è·å– 9.9.12-25493 çš„ wrapper.node

**æ–¹å¼ A: å¦‚æœå·²å®‰è£…æ—§ç‰ˆæœ¬ QQ**
```
è·¯å¾„: C:\Program Files\Tencent\QQ\resources\app.asar.unpacked\node_modules\wrapper.node
```

**æ–¹å¼ B: ä¸‹è½½æ—§ç‰ˆæœ¬**
- ä» QQ å®˜ç½‘ä¸‹è½½å†å²ç‰ˆæœ¬
- æˆ–ä»ç½‘ç›˜/é•œåƒç«™è·å–
- å®‰è£…åæå– wrapper.node æ–‡ä»¶

**æ–¹å¼ C: ä½¿ç”¨å¤‡ä»½**
- æ£€æŸ¥æ˜¯å¦æœ‰ç³»ç»Ÿå¤‡ä»½æˆ–å¿«ç…§
- ä»å¤‡ä»½ä¸­æå– wrapper.node

### 2. å‡†å¤‡å·¥å…·

- **x64dbg** (æ¨è): https://x64dbg.com/
- **IDA Pro** (å¯é€‰): https://hex-rays.com/
- **PE-bear** (å¯é€‰): https://github.com/hasherezade/pe-bear

---

## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ x64dbg æŸ¥æ‰¾ï¼ˆæœ€ç›´æ¥ï¼‰

### Step 1: åŠ è½½ wrapper.node

```
1. æ‰“å¼€ x64dbg (x64 ç‰ˆæœ¬)
2. æ–‡ä»¶ â†’ æ‰“å¼€
3. é€‰æ‹© 9.9.12-25493 çš„ wrapper.node
4. ç­‰å¾…åŠ è½½å®Œæˆ
```

### Step 2: æŸ¥çœ‹æ¨¡å—åŸºå€

åŠ è½½åï¼Œè®°å½•æ¨¡å—åŸºå€ï¼Œä¾‹å¦‚ï¼š`180000000`

### Step 3: è®¡ç®—å‡½æ•°åœ°å€

```
å·²çŸ¥åç§»å€¼: 0xA996E0
æ¨¡å—åŸºå€: 0x180000000 (ç¤ºä¾‹)

å‡½æ•°åœ°å€ = åŸºå€ + åç§»
         = 0x180000000 + 0xA996E0
         = 0x180A996E0
```

ä½¿ç”¨ Windows è®¡ç®—å™¨ï¼ˆç¨‹åºå‘˜æ¨¡å¼ï¼‰è¿›è¡Œè®¡ç®—ã€‚

### Step 4: è·³è½¬åˆ°å‡½æ•°åœ°å€

```
1. åœ¨ x64dbg ä¸­æŒ‰ Ctrl+G
2. è¾“å…¥è®¡ç®—åçš„åœ°å€: 180A996E0
3. æŒ‰å›è½¦è·³è½¬
```

### Step 5: æŸ¥çœ‹å‡½æ•°ä¿¡æ¯

åˆ°è¾¾åœ°å€åï¼š

**æ–¹å¼ A: æŸ¥çœ‹å½“å‰ä½ç½®**
- å³é”® â†’ `åœ¨ç¬¦å·ä¸­è·Ÿéš`
- æˆ–å³é”® â†’ `æ ‡ç­¾` â†’ æŸ¥çœ‹å‡½æ•°å

**æ–¹å¼ B: æŸ¥çœ‹å¯¼å‡ºè¡¨**
1. æŒ‰ `Ctrl+E` æ‰“å¼€å¯¼å‡ºè¡¨
2. æŸ¥æ‰¾åœ°å€ä¸º `180A996E0` çš„å‡½æ•°
3. è®°å½•å‡½æ•°åç§°

**æ–¹å¼ C: æŸ¥çœ‹åæ±‡ç¼–çª—å£é¡¶éƒ¨**
- å‡½æ•°å¼€å¤´é€šå¸¸ä¼šæ˜¾ç¤ºå‡½æ•°åæˆ–æ ‡ç­¾
- ä¾‹å¦‚: `wrapper.?FunctionName@@...` æˆ– `sub_A996E0`

### Step 6: åˆ†æå‡½æ•°ç‰¹å¾

éªŒè¯è¿™æ˜¯ç­¾åå‡½æ•°ï¼š

```asm
; åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š
wrapper+A996E0:
48 89 5C 24 08    mov [rsp+8], rbx       ; ä¿å­˜å¯„å­˜å™¨
48 89 6C 24 10    mov [rsp+10], rbp
48 89 74 24 18    mov [rsp+18], rsi
57                push rdi
48 83 EC 50       sub rsp, 50             ; åˆ†é…æ ˆç©ºé—´

; å‚æ•°å¤„ç†
48 8B F1          mov rsi, rcx            ; cmd (ç¬¬1ä¸ªå‚æ•°)
48 8B EA          mov rbp, rdx            ; src (ç¬¬2ä¸ªå‚æ•°)
4C 8B F0          mov r14, r8             ; src_len (ç¬¬3ä¸ªå‚æ•°)
44 8B F9          mov r15d, r9d           ; seq (ç¬¬4ä¸ªå‚æ•°)
```

**ç¡®è®¤ç‰¹å¾ï¼š**
- âœ… æœ‰ 5 ä¸ªå‚æ•°çš„ä½¿ç”¨
- âœ… å‡½æ•°ä½“è¾ƒå¤§ï¼ˆæ•°ç™¾å­—èŠ‚ï¼‰
- âœ… åŒ…å«å¤æ‚çš„ä½è¿ç®—å’Œå¾ªç¯
- âœ… æ“ä½œå­—èŠ‚æ•°ç»„

---

## æ–¹æ³•äºŒï¼šä½¿ç”¨ dumpbin å‘½ä»¤è¡Œå·¥å…·

### å‰ææ¡ä»¶

å®‰è£…äº† Visual Studio æˆ– Visual Studio Build Tools

### æ“ä½œæ­¥éª¤

1. **æ‰“å¼€ Visual Studio Developer Command Prompt**
   ```
   å¼€å§‹èœå• â†’ Visual Studio â†’ Developer Command Prompt
   ```

2. **è¿è¡Œ dumpbin**
   ```cmd
   cd "è·¯å¾„\åˆ°\wrapper.nodeæ‰€åœ¨ç›®å½•"
   dumpbin /EXPORTS wrapper.node > exports.txt
   ```

3. **åˆ†æè¾“å‡ºæ–‡ä»¶**
   
   æ‰“å¼€ `exports.txt`ï¼ŒæŸ¥æ‰¾ RVA ä¸º `A996E0` çš„å¯¼å‡ºï¼š

   ```
   ordinal hint RVA      name
   
         1    0 00001000 node_register_module
         2    1 00A996E0 ?å¯èƒ½çš„å‡½æ•°å?
   ```

4. **è®°å½•å‡½æ•°å**
   
   æ‰¾åˆ°å¯¹åº” RVA çš„å‡½æ•°åç§°

---

## æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ IDA Pro åˆ†æï¼ˆä¸“ä¸šæ–¹æ³•ï¼‰

### Step 1: åŠ è½½æ–‡ä»¶

```
1. æ‰“å¼€ IDA Pro (64-bit)
2. File â†’ Open
3. é€‰æ‹© 9.9.12-25493 çš„ wrapper.node
4. é€‰æ‹© PE64 æ ¼å¼
5. ç­‰å¾…è‡ªåŠ¨åˆ†æå®Œæˆ
```

### Step 2: è·³è½¬åˆ°åç§»åœ°å€

```
1. æŒ‰ G (è·³è½¬)
2. è¾“å…¥åœ°å€: imagebase+A996E0
   æˆ–ç›´æ¥è¾“å…¥: .text:00000000A996E0
3. æŒ‰å›è½¦
```

### Step 3: æŸ¥çœ‹å‡½æ•°å

åˆ°è¾¾åœ°å€åï¼š

**æŸ¥çœ‹å‡½æ•°çª—å£ï¼š**
1. `View` â†’ `Open subviews` â†’ `Functions`
2. æ‰¾åˆ°åç§»ä¸º `A996E0` çš„å‡½æ•°
3. æŸ¥çœ‹å‡½æ•°ååˆ—

**æŸ¥çœ‹åç¼–è¯‘ä»£ç ï¼š**
1. åœ¨å‡½æ•°åœ°å€å¤„æŒ‰ `F5` åç¼–è¯‘
2. æŸ¥çœ‹å‡½æ•°ç­¾åå’Œåç§°

```c
// å¯èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š
__int64 __fastcall sign_function_name(
    const char *cmd,
    const unsigned char *src,
    unsigned __int64 src_len,
    int seq,
    unsigned char *result)
{
    // å‡½æ•°å®ç°
}
```

### Step 4: æŸ¥çœ‹å¯¼å‡ºè¡¨

```
1. View â†’ Open subviews â†’ Exports
2. æˆ–æŒ‰ Shift+F7
3. æŸ¥æ‰¾ RVA ä¸º A996E0 çš„å¯¼å‡º
4. è®°å½•å‡½æ•°å
```

---

## æ–¹æ³•å››ï¼šä½¿ç”¨ Python è„šæœ¬è‡ªåŠ¨åŒ–

### å®‰è£…ä¾èµ–

```bash
pip install pefile
```

### åˆ›å»ºåˆ†æè„šæœ¬

åˆ›å»ºæ–‡ä»¶ `find_sign_function.py`:

```python
import pefile
import sys

# wrapper.node æ–‡ä»¶è·¯å¾„
wrapper_path = r"C:\path\to\9.9.12-25493\wrapper.node"

# å·²çŸ¥çš„åç§»å€¼
TARGET_OFFSET = 0xA996E0

try:
    pe = pefile.PE(wrapper_path)
    
    print("=" * 70)
    print("åˆ†æ wrapper.node (9.9.12-25493)")
    print("=" * 70)
    print(f"\nç›®æ ‡åç§»å€¼: 0x{TARGET_OFFSET:X}")
    print()
    
    # æŸ¥æ‰¾å¯¼å‡ºå‡½æ•°
    if hasattr(pe, 'DIRECTORY_ENTRY_EXPORT'):
        print("å¯¼å‡ºå‡½æ•°åˆ—è¡¨:")
        print("-" * 70)
        print(f"{'åºå·':<6} {'RVA':<12} {'åç§°'}")
        print("-" * 70)
        
        found = False
        for export in pe.DIRECTORY_ENTRY_EXPORT.symbols:
            ordinal = export.ordinal
            address = export.address
            name = export.name.decode() if export.name else f"Ordinal_{ordinal}"
            
            # æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡å‡½æ•°
            if address == TARGET_OFFSET:
                print(f"{ordinal:<6} 0x{address:08X}  {name}  â­â­â­ æ‰¾åˆ°äº†ï¼")
                found = True
            else:
                print(f"{ordinal:<6} 0x{address:08X}  {name}")
        
        if found:
            print()
            print("=" * 70)
            print("âœ… æˆåŠŸæ‰¾åˆ°åç§»å€¼å¯¹åº”çš„å‡½æ•°ï¼")
            print("=" * 70)
        else:
            print()
            print("âš ï¸  æœªåœ¨å¯¼å‡ºè¡¨ä¸­æ‰¾åˆ°è¯¥åç§»å€¼")
            print("å¯èƒ½æ˜¯å†…éƒ¨å‡½æ•°ï¼ˆæœªå¯¼å‡ºï¼‰")
    else:
        print("âŒ æœªæ‰¾åˆ°å¯¼å‡ºè¡¨")
    
except Exception as e:
    print(f"âŒ é”™è¯¯: {e}")
    sys.exit(1)
```

### è¿è¡Œè„šæœ¬

```bash
python find_sign_function.py
```

---

## å¯èƒ½çš„ç»“æœ

### æƒ…å†µ 1: æ‰¾åˆ°æ˜ç¡®çš„å‡½æ•°å

**ç¤ºä¾‹ï¼š**
```
åºå·  RVA         åç§°
5     0x00A996E0  sign
æˆ–
5     0x00A996E0  createSign
æˆ–
5     0x00A996E0  doSignature
```

**ä¸‹ä¸€æ­¥ï¼š**
- è®°å½•å‡½æ•°åç§°
- éªŒè¯å‡½æ•°ç­¾åï¼ˆ5ä¸ªå‚æ•°ï¼‰
- åœ¨ 9.9.20 ç‰ˆæœ¬ä¸­æŸ¥æ‰¾åŒåå‡½æ•°

### æƒ…å†µ 2: C++ Mangled Name

**ç¤ºä¾‹ï¼š**
```
5     0x00A996E0  ?sign@WrapperClass@@QEAAHPEBDPEBEKHPEAE@Z
```

**è§£ç  Mangled Nameï¼š**

ä½¿ç”¨åœ¨çº¿å·¥å…·ï¼šhttps://demangler.com/

æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š
```cmd
undname "?sign@WrapperClass@@QEAAHPEBDPEBEKHPEAE@Z"
```

è§£ç åå¯èƒ½å¾—åˆ°ï¼š
```
public: int __cdecl WrapperClass::sign(char const *, unsigned char const *, unsigned __int64, int, unsigned char *)
```

### æƒ…å†µ 3: ä»…åºå·å¯¼å‡º

**ç¤ºä¾‹ï¼š**
```
5     0x00A996E0  Ordinal_5
```

**è¯´æ˜ï¼š**
- å‡½æ•°æœªå¯¼å‡ºåç§°ï¼Œåªæœ‰åºå·
- éœ€è¦é€šè¿‡åºå·åœ¨ 9.9.20 ä¸­æŸ¥æ‰¾
- æˆ–é€šè¿‡æ±‡ç¼–ä»£ç ç‰¹å¾åŒ¹é…

### æƒ…å†µ 4: æœªåœ¨å¯¼å‡ºè¡¨ä¸­

**è¯´æ˜ï¼š**
- å‡½æ•°å¯èƒ½æ˜¯å†…éƒ¨å‡½æ•°ï¼ˆstaticï¼‰
- æœªè¢«å¯¼å‡ºåˆ° DLL å¤–éƒ¨
- åªèƒ½é€šè¿‡ç‰¹å¾ç åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**
- è®°å½•å‡½æ•°çš„æ±‡ç¼–ç‰¹å¾ç 
- åœ¨ 9.9.20 ä¸­æœç´¢ç›¸åŒçš„ç‰¹å¾ç 
- æˆ–ä½¿ç”¨ BinDiff ç­‰å·¥å…·å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬

---

## åº”ç”¨åˆ° 9.9.20 ç‰ˆæœ¬

### å¦‚æœæ‰¾åˆ°äº†å‡½æ•°å

1. **åœ¨ 9.9.20 çš„ wrapper.node ä¸­æŸ¥æ‰¾åŒåå‡½æ•°**
   
   ```
   - ä½¿ç”¨ x64dbg æ‰“å¼€ 9.9.20 çš„ wrapper.node
   - æŒ‰ Ctrl+E æŸ¥çœ‹å¯¼å‡ºè¡¨
   - æœç´¢ç›¸åŒçš„å‡½æ•°å
   - è®°å½•æ–°ç‰ˆæœ¬ä¸­çš„åç§»å€¼
   ```

2. **å¦‚æœå‡½æ•°åç›¸åŒä½†åç§»ä¸åŒ**
   
   ```
   - è¿™æ˜¯æ­£å¸¸çš„ï¼ˆç‰ˆæœ¬æ›´æ–°å¯¼è‡´åœ°å€å˜åŒ–ï¼‰
   - ä½¿ç”¨æ–°ç‰ˆæœ¬çš„åç§»å€¼
   - æ›´æ–° sign.cpp ä¸­çš„ addrMap
   ```

3. **å¦‚æœæ‰¾ä¸åˆ°åŒåå‡½æ•°**
   
   ```
   - å‡½æ•°å¯èƒ½è¢«é‡å‘½å
   - æˆ–è¢«å†…è”/ä¼˜åŒ–
   - éœ€è¦é€šè¿‡ç‰¹å¾ç åŒ¹é…
   ```

### å¦‚æœæ˜¯ Mangled Name

1. **è§£ç ååœ¨ 9.9.20 ä¸­æŸ¥æ‰¾**
   
   ```
   - æŸ¥æ‰¾ç›¸åŒçš„ç±»å’Œæ–¹æ³•å
   - æ³¨æ„å‚æ•°ç±»å‹å¯èƒ½ç•¥æœ‰å˜åŒ–
   ```

### å¦‚æœåªæœ‰åºå·

1. **åœ¨ 9.9.20 ä¸­æŸ¥æ‰¾ç›¸åŒåºå·**
   
   ```
   - åºå·é€šå¸¸ä¿æŒä¸€è‡´
   - ä½†ä¸æ˜¯ç»å¯¹çš„
   - éœ€è¦éªŒè¯å‡½æ•°ç‰¹å¾
   ```

---

## ç‰¹å¾ç åŒ¹é…æ–¹æ³•ï¼ˆé«˜çº§ï¼‰

å¦‚æœå‡½æ•°æœªå¯¼å‡ºæˆ–åç§°æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹å¾ç ï¼š

### æå–ç‰¹å¾ç 

åœ¨ x64dbg ä¸­ï¼š

1. è·³è½¬åˆ° 9.9.12-25493 çš„å‡½æ•°åœ°å€ (0xA996E0)
2. é€‰æ‹©å‡½æ•°å¼€å¤´çš„ 16-32 å­—èŠ‚
3. å³é”® â†’ `äºŒè¿›åˆ¶` â†’ `å¤åˆ¶é€‰æ‹©`
4. è®°å½•å­—èŠ‚åºåˆ—ï¼Œä¾‹å¦‚ï¼š
   ```
   48 89 5C 24 08 48 89 6C 24 10 48 89 74 24 18 57 48 83 EC 50
   ```

### åœ¨ 9.9.20 ä¸­æœç´¢

1. æ‰“å¼€ 9.9.20 çš„ wrapper.node
2. å³é”® â†’ `æœç´¢` â†’ `åºåˆ—`
3. è¾“å…¥ç‰¹å¾å­—èŠ‚ç 
4. æŸ¥æ‰¾åŒ¹é…é¡¹
5. è®°å½•æ–°çš„åç§»å€¼

---

## è®°å½•æ¨¡æ¿

æ‰¾åˆ°å‡½æ•°åï¼Œè¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

```
=== ç­¾åå‡½æ•°ä¿¡æ¯ ===

9.9.12-25493 ç‰ˆæœ¬:
  å‡½æ•°åç§°: [å¡«å†™]
  åç§»å€¼: 0xA996E0
  å¯¼å‡ºåºå·: [å¡«å†™]
  
9.9.20-37051 ç‰ˆæœ¬:
  å‡½æ•°åç§°: [å¡«å†™]
  åç§»å€¼: [å¾…ç¡®å®š]
  å¯¼å‡ºåºå·: [å¡«å†™]
  
å‡½æ•°ç‰¹å¾ç :
  [å‰16å­—èŠ‚çš„åå…­è¿›åˆ¶]
  
éªŒè¯çŠ¶æ€:
  [ ] å‡½æ•°ååŒ¹é…
  [ ] å‚æ•°æ•°é‡æ­£ç¡® (5ä¸ª)
  [ ] ç‰¹å¾ç ç›¸ä¼¼
  [ ] æµ‹è¯•é€šè¿‡
```

---

## å¿«é€Ÿæ“ä½œæ¸…å•

### å¦‚æœä½ æœ‰ 9.9.12-25493 çš„ wrapper.node

âœ… **ç«‹å³æ‰§è¡Œï¼š**

1. ç”¨ x64dbg æ‰“å¼€ 9.9.12-25493 çš„ wrapper.node
2. æŒ‰ Ctrl+E æŸ¥çœ‹å¯¼å‡ºè¡¨
3. æŸ¥æ‰¾ RVA ä¸º `A996E0` çš„å‡½æ•°
4. è®°å½•å‡½æ•°å
5. å‘Šè¯‰æˆ‘ç»“æœï¼

### å¦‚æœæ²¡æœ‰æ—§ç‰ˆæœ¬

â­ï¸ **æ›¿ä»£æ–¹æ¡ˆï¼š**

1. ç›´æ¥åœ¨ 9.9.20 ä¸­æµ‹è¯•å·²çŸ¥åç§»å€¼
2. ä½¿ç”¨è¯•é”™æ³•æ‰¾åˆ°æ­£ç¡®åç§»
3. æˆ–ç­‰å¾…ç¤¾åŒºåˆ†äº« 9.9.20 çš„ä¿¡æ¯

---

## æç¤º

ğŸ’¡ **æœ€å¿«çš„æ–¹æ³•ï¼š**
- å¦‚æœèƒ½è®¿é—® 9.9.12 ç‰ˆæœ¬ï¼Œç”¨ x64dbg çš„ Ctrl+E æŸ¥çœ‹å¯¼å‡ºè¡¨æœ€ç›´æ¥
- åªéœ€è¦ 1-2 åˆ†é’Ÿå°±èƒ½æ‰¾åˆ°å‡½æ•°å

ğŸ’¡ **å¦‚æœæ‰¾åˆ°å‡½æ•°åï¼š**
- ç«‹å³åˆ†äº«ç»™æˆ‘
- æˆ‘ä»¬å¯ä»¥åœ¨ 9.9.20 ä¸­å¿«é€Ÿå®šä½
- æé«˜æˆåŠŸç‡ï¼

å–µ~ å‡†å¤‡å¥½äº†å°±å¼€å§‹å§ï¼ğŸ¾
